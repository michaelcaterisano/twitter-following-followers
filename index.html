<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Two Sine Saves</title>
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, maximum-scale=1"
        />

        <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.26/Tone.js"></script>
    </head>

    <body>
        <div>
            <p>Matt Sargent's current Twitter following/follower ratio</p>
            <span id="following"></span><span>:</span
            ><span id="followers"></span>
            <p>click anywhere to listen</p>
        </div>

        <script>
            let followingFreq = 0
            let followersFreq = 0

            const merge = new Tone.Merge().toDestination()
            const followingSynth = new Tone.Oscillator(followingFreq, 'sine1')
                .connect(merge, 0, 0)
                .start()
            const followersSynth = new Tone.Oscillator(followersFreq, 'sine1')
                .connect(merge, 0, 0)
                .start()

            followingSynth.volume.value = -10
            followersSynth.volume.value = -10

            const followingSignal = new Tone.Signal({
                value: followingFreq,
                units: 'frequency',
            }).connect(followingSynth.frequency)

            const followersSignal = new Tone.Signal({
                value: followersFreq,
                units: 'frequency',
            }).connect(followersSynth.frequency)

            const followersSpan = document.querySelector('#followers')
            console.log({ followersSpan })
            const followingSpan = document.querySelector('#following')

            document.addEventListener('click', () => {
                Tone.start()
                followingSignal.rampTo(followingFreq, 0)
                followersSignal.rampTo(followersFreq, 0)
            })
            window.onload = async () => {
                fetch('http://localhost:3000/followers')
                    .then((response) => response.json())
                    .then(({ followers, following }) => {
                        followingFreq = following
                        followersFreq = followers
                        followersSpan.textContent = followers
                        followingSpan.innerText = following
                    })
            }
        </script>
    </body>
</html>
